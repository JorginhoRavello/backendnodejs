<svg xmlns="http://www.w3.org/2000/svg" width="589.827" height="361.238" version="1.2" viewBox="0 0 442.37 270.929"><defs><clipPath id="a"><path d="M239.03 226.605l-42.13 24.317c-1.578.91-2.546 2.59-2.546 4.406v48.668c0 1.817.968 3.496 2.546 4.406l42.133 24.336c1.575.907 3.517.907 5.09 0l42.126-24.336c1.57-.91 2.54-2.59 2.54-4.406v-48.668c0-1.816-.97-3.496-2.55-4.406l-42.12-24.317c-.79-.453-1.67-.68-2.55-.68-.88 0-1.76.227-2.55.68"/></clipPath><linearGradient id="b" x1="-.348" x2="1.251" gradientTransform="rotate(116.114 53.1 202.97) scale(86.48)" gradientUnits="userSpaceOnUse"><stop offset=".3" stop-color="#3E863D"/><stop offset=".5" stop-color="#55934F"/><stop offset=".8" stop-color="#5AAD45"/></linearGradient><clipPath id="c"><path d="M195.398 307.086c.403.523.907.976 1.5 1.316l36.14 20.875 6.02 3.46c.9.52 1.926.74 2.934.665.336-.027.672-.09 1-.183l44.434-81.36c-.34-.37-.738-.68-1.184-.94l-27.586-15.93-14.582-8.39c-.414-.24-.863-.41-1.32-.53zm0 0"/></clipPath><linearGradient id="d" x1="-.456" x2=".582" gradientTransform="rotate(-36.46 550.846 -214.337) scale(132.798)" gradientUnits="userSpaceOnUse"><stop offset=".57" stop-color="#3E863D"/><stop offset=".72" stop-color="#619857"/><stop offset="1" stop-color="#76AC64"/></linearGradient><clipPath id="e"><path d="M241.066 225.953c-.707.07-1.398.29-2.035.652l-42.01 24.247 45.3 82.51c.63-.09 1.25-.3 1.81-.624l42.13-24.336c1.3-.754 2.19-2.03 2.46-3.476l-46.18-78.89c-.34-.067-.68-.102-1.03-.102-.14 0-.28.007-.42.02"/></clipPath><linearGradient id="f" x1=".043" x2=".984" gradientTransform="translate(192.862 279.652) scale(97.417)" gradientUnits="userSpaceOnUse"><stop offset=".16" stop-color="#6BBF47"/><stop offset=".38" stop-color="#79B461"/><stop offset=".47" stop-color="#75AC64"/><stop offset=".7" stop-color="#659E5A"/><stop offset=".9" stop-color="#3E863D"/></linearGradient></defs><path fill="#689f63" d="M218.647 270.93c-1.46 0-2.91-.383-4.19-1.12l-13.337-7.896c-1.992-1.114-1.02-1.508-.363-1.735 2.656-.93 3.195-1.14 6.03-2.75.298-.17.688-.11.993.07l10.246 6.08c.37.2.895.2 1.238 0l39.95-23.06c.37-.21.61-.64.61-1.08v-46.1c0-.46-.24-.87-.618-1.1l-39.934-23.04c-.37-.22-.86-.22-1.23 0l-39.926 23.04c-.387.22-.633.65-.633 1.09v46.1c0 .44.24.86.62 1.07l10.94 6.32c5.94 2.97 9.57-.53 9.57-4.05v-45.5c0-.65.51-1.15 1.16-1.15h5.06c.63 0 1.15.5 1.15 1.15v45.52c0 7.92-4.32 12.47-11.83 12.47-2.31 0-4.13 0-9.21-2.5l-10.48-6.04c-2.59-1.5-4.19-4.3-4.19-7.29v-46.1c0-3 1.6-5.8 4.19-7.28l39.99-23.07c2.53-1.43 5.89-1.43 8.4 0l39.94 23.08c2.58 1.49 4.19 4.28 4.19 7.28v46.1c0 2.99-1.61 5.78-4.19 7.28l-39.94 23.07c-1.28.74-2.73 1.12-4.21 1.12"/><path fill="#689f63" d="M230.987 239.164c-17.48 0-21.145-8.024-21.145-14.754 0-.64.516-1.15 1.157-1.15h5.16c.57 0 1.05.415 1.14.978.78 5.258 3.1 7.91 13.67 7.91 8.42 0 12-1.902 12-6.367 0-2.57-1.02-4.48-14.1-5.76-10.94-1.08-17.7-3.49-17.7-12.24 0-8.06 6.8-12.86 18.19-12.86 12.79 0 19.13 4.44 19.93 13.98.03.33-.09.65-.31.89-.22.23-.53.37-.85.37h-5.19c-.54 0-1.01-.38-1.12-.9-1.25-5.53-4.27-7.3-12.48-7.3-9.19 0-10.26 3.2-10.26 5.6 0 2.91 1.26 3.76 13.66 5.4 12.28 1.63 18.11 3.93 18.11 12.56 0 8.7-7.26 13.69-19.92 13.69m48.66-48.89h1.34c1.1 0 1.31-.77 1.31-1.22 0-1.18-.81-1.18-1.26-1.18h-1.38zm-1.63-3.78h2.97c1.02 0 3.02 0 3.02 2.28 0 1.59-1.02 1.92-1.63 2.12 1.19.08 1.27.86 1.43 1.96.08.69.21 1.88.45 2.28h-1.83c-.05-.4-.33-2.6-.33-2.72-.12-.49-.29-.73-.9-.73h-1.51v3.46h-1.67zm-3.57 4.3c0 3.58 2.89 6.48 6.44 6.48 3.58 0 6.47-2.96 6.47-6.48 0-3.59-2.93-6.44-6.48-6.44-3.5 0-6.44 2.81-6.44 6.43m14.16.03c0 4.24-3.47 7.7-7.7 7.7-4.2 0-7.7-3.42-7.7-7.7 0-4.36 3.58-7.7 7.7-7.7 4.15 0 7.69 3.35 7.69 7.7"/><path fill="#333" fill-rule="evenodd" d="M94.936 90.55c0-1.84-.97-3.53-2.558-4.445l-42.356-24.37c-.715-.42-1.516-.64-2.328-.67h-.438c-.812.03-1.613.25-2.34.67L2.562 86.105C.984 87.025 0 88.715 0 90.555l.093 65.64c0 .91.47 1.76 1.27 2.21.78.48 1.76.48 2.54 0l25.18-14.42c1.59-.946 2.56-2.618 2.56-4.44V108.88c0-1.83.97-3.52 2.555-4.43l10.72-6.174c.796-.46 1.67-.688 2.56-.688.876 0 1.77.226 2.544.687l10.715 6.172c1.586.91 2.56 2.6 2.56 4.43v30.663c0 1.82.983 3.5 2.565 4.44l25.164 14.41c.79.47 1.773.47 2.56 0 .776-.45 1.268-1.3 1.268-2.21zm199.868 34.176c0 .457-.243.88-.64 1.106l-14.548 8.386c-.395.227-.883.227-1.277 0l-14.55-8.386c-.4-.227-.64-.65-.64-1.106V107.93c0-.458.24-.88.63-1.11l14.54-8.4c.4-.23.89-.23 1.29 0l14.55 8.4c.4.23.64.652.64 1.11zM298.734.324c-.794-.442-1.76-.43-2.544.027-.78.46-1.262 1.3-1.262 2.21v65c0 .64-.34 1.23-.894 1.55-.55.32-1.235.32-1.79 0L281.634 63c-1.58-.914-3.526-.914-5.112 0l-42.37 24.453c-1.583.91-2.56 2.6-2.56 4.42v48.92c0 1.83.977 3.51 2.56 4.43l42.37 24.47c1.582.91 3.53.91 5.117 0l42.37-24.48c1.58-.92 2.56-2.6 2.56-4.43V18.863c0-1.856-1.01-3.563-2.63-4.47zm141.093 107.164c1.574-.914 2.543-2.602 2.543-4.422V91.21c0-1.824-.97-3.507-2.547-4.425l-42.1-24.44c-1.59-.92-3.54-.92-5.13 0l-42.36 24.45c-1.59.92-2.56 2.6-2.56 4.43v48.9c0 1.84.99 3.54 2.58 4.45l42.09 23.99c1.55.89 3.45.9 5.02.03l25.46-14.15c.8-.45 1.31-1.3 1.31-2.22 0-.92-.49-1.78-1.29-2.23l-42.62-24.46c-.8-.45-1.29-1.3-1.29-2.21v-15.34c0-.916.48-1.76 1.28-2.216l13.26-7.65c.79-.46 1.76-.46 2.55 0l13.27 7.65c.79.45 1.28 1.3 1.28 2.21v12.06c0 .91.49 1.76 1.28 2.22.79.45 1.77.45 2.56-.01zm0 0"/><path fill="#689f63" fill-rule="evenodd" d="M394.538 105.2c.3-.177.676-.177.98 0l8.13 4.69c.304.176.49.5.49.85v9.39c0 .35-.186.674-.49.85l-8.13 4.69c-.304.177-.68.177-.98 0l-8.125-4.69c-.31-.176-.5-.5-.5-.85v-9.39c0-.35.18-.674.49-.85zm0 0"/><g clip-path="url(#a)" transform="translate(-78.306 -164.016)"><path fill="url(#b)" d="M331.363 246.793l-118.715-58.19-60.87 124.174L270.49 370.97zm0 0"/></g><g clip-path="url(#c)" transform="translate(-78.306 -164.016)"><path fill="url(#d)" d="M144.07 264.004l83.825 113.453 110.86-81.906-83.83-113.45zm0 0"/></g><g clip-path="url(#e)" transform="translate(-78.306 -164.016)"><path fill="url(#f)" d="M197.02 225.934v107.43h91.683v-107.43zm0 0"/></g></svg> 

  <h1>Backend con Node.js</h1>
</div>	</div>


<div align="center">
  <img src="./assets/nodejs-logo.svg"
    width="60%"
   alt="nodejs-logo">
</div>

## Tabla de contenido	## Tabla de contenido
- [¬øQu√© es Node.js y para que sirve?](#qu√©-es-nodejs-y-para-que-sirve)	- [¬øQu√© es Node.js y para que sirve?](#qu√©-es-nodejs-y-para-que-sirve)
- [Fechas importantes de NodeJS](#fechas-importantes-de-nodejs)
- [Diferencias entre NodeJs y Javascript](#diferencias-entre-nodejs-y-javascript)
- [Instalaci√≥n de Node.js](#instalaci√≥n-de-nodejs)
- [Arquitectura orientada a eventos](#arquitectura-orientada-a-eventos)
- [Event Emiter](#event-emiter)
- [Primer Servidor HTTP](#primer-servidor-http)
- [Sreams](#sreams)
- [Readable y Writable Streams](#readable-y-writable-streams)
- [Duplex y Transforms streams](#duplex-y-transforms-streams)
- [Uso de utilidades que tiene NodeJS](#uso-de-utilidades-que-tiene-nodejs)
  - [Utilidades del sistema operativo](#utilidades-del-sistema-operativo)
  - [Utilidades con el sistema de archivos](#utilidades-con-el-sistema-de-archivos)
- [Administrar directorios y archivos](#administrar-directorios-y-archivos)
- [Consola, utilidades y debuggin](#consola-utilidades-y-debuggin)
- [Deprecate](#deprecate)
- [Debuggin en node](#debuggin-en-node)
- [Clusters y procesos hijos](#clusters-y-procesos-hijos)
- [Request y Response Objects](#request-y-response-objects)
  - [Request body](#request-body)
  - [Request params](#request-params)
  - [Request query](#request-query)
  - [Response object](#response-object)
- [Exploremos los m√©todos m√°s comunes](#exploremos-los-m√©todos-m√°s-comunes)
  - [Response end()](#response-end)
  - [Response json()](#response-json)
  - [Response send()](#response-send)
- [¬øQu√© es express y para que sirve?](#qu√©-es-express-y-para-que-sirve)
  - [Crea tu primer servidor en express](#crea-tu-primer-servidor-en-express)
- [Anatom√≠a de una API Restful](#anatom√≠a-de-una-api-restful)
- [Estructura de una pel√≠cula con Mockaroo](#estructura-de-una-pel√≠cula-con-mockaroo)
- [Implementando un CRUD en express.js](#implementando-un-crud-en-expressjs)
  - [M√©todos idempotentes del CRUD](#m√©todos-idempotentes-del-crud)
- [Implementando una capa de servicios en express](#implementando-una-capa-de-servicios-en-express)
- [Creaci√≥n de una BD en MongoAtlas](#creaci√≥n-de-una-bd-en-mongoatlas)
  - [Conexi√≥n a MongoAtlas una instancia de MongoDB](#conexi√≥n-a-mongoatlas-una-instancia-de-mongodb)
  - [Implementaci√≥n de las acciones de MongoDB](#implementaci√≥n-de-las-acciones-de-mongodb)
  - [Conexi√≥n de nuestros servicios con MongoDB](#conexi√≥n-de-nuestros-servicios-con-mongodb)
- [¬øQu√© es un middleware?](#qu√©-es-un-middleware)
- [Manejador de erroes as√≠ncronos y s√≠ncronos en Express](#manejador-de-erroes-as√≠ncronos-y-s√≠ncronos-en-express)
- [Capa de validaci√≥n de datos a trav√©z de un middleware](#capa-de-validaci√≥n-de-datos-a-trav√©z-de-un-middleware)
- [¬øQu√© es Join y Boom?](#qu√©-es-join-y-boom)
  - [Implementando Boom](#implementando-boom)
  - [Implementando Joi](#implementando-joi)
- [Middlewares populares en Express.js](#middlewares-populares-en-expressjs)
- [Debugging e inspect](#debugging-e-inspect)
  - [Haciendo debugging](#haciendo-debugging)
- [Ejecutando el modo inspect en desarrollo](#ejecutando-el-modo-inspect-en-desarrollo)
- [Tests](#tests)
  - [Creaci√≥n de test para nuestros endpoints](#creaci√≥n-de-test-para-nuestros-endpoints)
  - [Creaci√≥n de Test para nuestros servicios](#creaci√≥n-de-test-para-nuestros-servicios)
  - [Creaci√≥n de Test para nuestras utilidades](#creaci√≥n-de-test-para-nuestras-utilidades)
  - [Agregando un comando coverage](#agregando-un-comando-coverage)
- [Considerenado las mejores pr√°cticas para el despliegue](#considerenado-las-mejores-pr√°cticas-para-el-despliegue)
- [Variables de entorno, CORS y HTTPS](#variables-de-entorno-cors-y-https)
  - [Como usar las variables de entorno para diferentes ambientes](#como-usar-las-variables-de-entorno-para-diferentes-ambientes)
  - [¬øCuando no es posible acceder al servidor remoto?](#cuando-no-es-posible-acceder-al-servidor-remoto)
  - [Variables de entorno de forma nativa](#variables-de-entorno-de-forma-nativa)
  - [Habilitando CORS en producci√≥n](#habilitando-cors-en-producci√≥n)
  - [Habilitar CORS para todos los request (No recomendado en producci√≥n)](#habilitar-cors-para-todos-los-request-no-recomendado-en-producci√≥n)
  - [Habilitar CORS para los request espec√≠ficos de un cliente (Recomendado para producci√≥n)](#habilitar-cors-para-los-request-espec√≠ficos-de-un-cliente-recomendado-para-producci√≥n)
- [C√≥mo funciona y por qu√© es importante el uso de HTTPS](#c√≥mo-funciona-y-por-qu√©-es-importante-el-uso-de-https)
  - [Por qu√© usar HTTPS](#por-qu√©-usar-https)
  - [C√≥mo habilitar HTTPS en nuestro servidor](#c√≥mo-habilitar-https-en-nuestro-servidor)
- [Como implementar una capa de manejo de cach√© en express](#como-implementar-una-capa-de-manejo-de-cach√©-en-express)
- [¬øC√≥mo contener tu aplicaci√≥n en Docker?](#c√≥mo-contener-tu-aplicaci√≥n-en-docker)
- [Despliegue en now](#despliegue-en-now)

## ¬øQu√© es Node.js y para que sirve?


@@ -45,7 +117,7 @@ Nodejs fue tomar el engine de JS chrome V8 para crear un entorno de ejecuci√≥n y


En Javascript tenemos el [DOM document object model]() es la interfaz que nos permite interpretar el documento html en javascript como lo es el objeto window, tambi√©n tenemos el [CSSDOM]() que es la interfaz que nos permite **manipular el css** en javascript, por otro lado tenemos el [FetchAPI](https://developer.mozilla.org/es/docs/Web/API/Fetch_API) que por el cual podemos hacer **request** y que nos devuelva una promesa, tambi√©n tenemos toda la capa de [webstorage](https://www.w3schools.com/html/html5_webstorage.asp) que consiste en el [sessionStorage](https://developer.mozilla.org/es/docs/Web/API/Window/sessionStorage) y el [localStorage](https://developer.mozilla.org/es/docs/Web/API/Window/localStorage) que eso no existe en nodejs, tenemos el modulo de [canvas API](https://developer.mozilla.org/es/docs/Web/HTML/Canvas) que nos permite hacer gr√°ficos en la web en 2D y 3D y apartir de ahi tenemos una ser√≠e de APIS como lo son: el [Web Bluetooth AP](https://developer.mozilla.org/en-US/docs/Web/API/Web_Bluetooth_API), [AudioAPI](https://developer.mozilla.org/es/docs/Web_Audio_API) y [webAutenthicationAPI](https://developer.mozilla.org/en-US/docs/Web/API/Web_Authentication_API).	En Javascript tenemos el [DOM document object model]() es la interfaz que nos permite interpretar el documento html en javascript como lo es el objeto window, tambi√©n tenemos el [CSSDOM]() que es la interfaz que nos permite **manipular el css** en javascript, por otro lado tenemos el [FetchAPI](https://developer.mozilla.org/es/docs/Web/API/Fetch_API) que por el cual podemos hacer **request** y que nos devuelva una promesa, tambi√©n tenemos toda la capa de [webstorage](https://www.w3schools.com/html/html5_webstorage.asp) que consiste en el [sessionStorage](https://developer.mozilla.org/es/docs/Web/API/Window/sessionStorage) y el [localStorage](https://developer.mozilla.org/es/docs/Web/API/Window/localStorage) que eso no existe en nodejs, tenemos el modulo de [canvas API](https://developer.mozilla.org/es/docs/Web/HTML/Canvas) que nos permite hacer gr√°ficos en la web en 2D y 3D y apartir de ahi tenemos una ser√≠e de APIS como lo son: el [Web Bluetooth AP](https://developer.mozilla.org/en-US/docs/Web/API/Web_Bluetooth_API), [AudioAPI](https://developer.mozilla.org/es/docs/Web_Audio_API) y [webAutenthicationAPI](https://developer.mozilla.org/en-US/docs/Web/API/Web_Authentication_API).


Por otro lado en Nodejs tenemos una serie de modulos:	Por otro lado **en Nodejs** tenemos una serie de modulos:
- **Http**: permite crear servidores 	- **Http**: permite crear servidores 
- **Sistema operativo**: nos permite comunicarnos entre el sistema operativo y darnos informaci√≥n sobre el.	- **Sistema operativo**: nos permite comunicarnos entre el sistema operativo y darnos informaci√≥n sobre el.
- **Utilidades**: que son una serie de utilidades excusivas para nodejs	- **Utilidades**: que son una serie de utilidades excusivas para nodejs
@@ -55,6 +127,10 @@ Por otro lado en Nodejs tenemos una serie de modulos:
- **Ecmascript Modules**: se pueden ejecutar en nodejs mediante un feature *flag*	- **Ecmascript Modules**: se pueden ejecutar en nodejs mediante un feature *flag*
- **Consola**: es muy similar a la del navegador.	- **Consola**: es muy similar a la del navegador.


<div align="right">
  <small><a href="#tabla-de-contenido">ü°° volver al inicio</a></small>
</div>

## Instalaci√≥n de Node.js	## Instalaci√≥n de Node.js


Para instalar Node.js tienes que dirigirte a [nodejs.org](https://nodejs.org/es/) y elegir entre la ultima versi√≥n o la version LTS.	Para instalar Node.js tienes que dirigirte a [nodejs.org](https://nodejs.org/es/) y elegir entre la ultima versi√≥n o la version LTS.
@@ -198,7 +274,7 @@ logger.execute(() => setTimeout(() => console.log("Hello World"), 500));
  <small><a href="#tabla-de-contenido">ü°° volver al inicio</a></small>	  <small><a href="#tabla-de-contenido">ü°° volver al inicio</a></small>
</div>	</div>


## Primer Servidor	## Primer Servidor HTTP


En esta ocaci√≥n tenemos que leer cod√≠go e interpratar lo que se esta haciendo:	En esta ocaci√≥n tenemos que leer cod√≠go e interpratar lo que se esta haciendo:


@@ -783,9 +859,7 @@ app.get("/user/:id", function(request, response) {
  <small><a href="#tabla-de-contenido">ü°° volver al inicio</a></small>	  <small><a href="#tabla-de-contenido">ü°° volver al inicio</a></small>
</div>	</div>


### Exploremos las propiedades m√°s importantes	### Request body

**req.body**	


Contiene los pares de llave-valor de los datos enviados en el cuerpo (body) del llamado (request). Por defecto es ``undefined`` pero es establecido cuando se usa alg√∫n ‚Äúbody-parser‚Äù middleware como ``body-parser`` y ``multer``.	Contiene los pares de llave-valor de los datos enviados en el cuerpo (body) del llamado (request). Por defecto es ``undefined`` pero es establecido cuando se usa alg√∫n ‚Äúbody-parser‚Äù middleware como ``body-parser`` y ``multer``.


@@ -810,7 +884,11 @@ app.post("/profile", upload.array(), function(req, res, next) {


M√°s informaci√≥n sobre los diferentes formatos que puede tener el body: https://developer.mozilla.org/es/docs/Web/HTTP/Methods/POST	M√°s informaci√≥n sobre los diferentes formatos que puede tener el body: https://developer.mozilla.org/es/docs/Web/HTTP/Methods/POST


**req.params**	<div align="right">
  <small><a href="#tabla-de-contenido">ü°° volver al inicio</a></small>
</div>

### Request params


Esta propiedad contiene un objeto con las propiedades equivalentes a los par√°metros nombrados en la ruta. Por ejemplo, si tenemos una ruta de la forma ``/user/:name`` entonces la propiedad ``name`` est√° disponible como ``req.params.name`` y all√≠ podremos ver su valor. Supongamos que llamaramos a la ruta con /user/glrodasz, entonces el valor de ``req.params.name`` ser√≠a ``glrodasz``. Este objeto por defecto tiene el valor de un objeto vac√≠o ``{}``.	Esta propiedad contiene un objeto con las propiedades equivalentes a los par√°metros nombrados en la ruta. Por ejemplo, si tenemos una ruta de la forma ``/user/:name`` entonces la propiedad ``name`` est√° disponible como ``req.params.name`` y all√≠ podremos ver su valor. Supongamos que llamaramos a la ruta con /user/glrodasz, entonces el valor de ``req.params.name`` ser√≠a ``glrodasz``. Este objeto por defecto tiene el valor de un objeto vac√≠o ``{}``.


@@ -820,7 +898,11 @@ req.params.name;
// => "glrodasz"	// => "glrodasz"
```	```


**req.query**	<div align="right">
  <small><a href="#tabla-de-contenido">ü°° volver al inicio</a></small>
</div>

### Request query


Esta propiedad contiene un objeto con las propiedades equivalentes a las cadenas de texto query de la ruta. Si no hay ninguna cadena de texto query tendr√° como valor por defecto un objeto vac√≠o ``{}``.	Esta propiedad contiene un objeto con las propiedades equivalentes a las cadenas de texto query de la ruta. Si no hay ninguna cadena de texto query tendr√° como valor por defecto un objeto vac√≠o ``{}``.


@@ -841,7 +923,11 @@ req.query.shoe.type;


M√°s informaci√≥n sobre los query strings en: https://es.wikipedia.org/wiki/Query_string y https://tools.ietf.org/html/rfc3986#section-3.4	M√°s informaci√≥n sobre los query strings en: https://es.wikipedia.org/wiki/Query_string y https://tools.ietf.org/html/rfc3986#section-3.4


**Response Object**	<div align="right">
  <small><a href="#tabla-de-contenido">ü°° volver al inicio</a></small>
</div>

### Response Object


El objeto ``res`` representa la respuesta HTTP que env√≠a una aplicaci√≥n en Express.	El objeto ``res`` representa la respuesta HTTP que env√≠a una aplicaci√≥n en Express.


@@ -867,9 +953,9 @@ app.get("/user/:id", function(request, response) {
  <small><a href="#tabla-de-contenido">ü°° volver al inicio</a></small>	  <small><a href="#tabla-de-contenido">ü°° volver al inicio</a></small>
</div>	</div>


### Exploremos los m√©todos m√°s comunes	## Exploremos los m√©todos m√°s comunes


**res.end()**	### Response end()


Finaliza el proceso de respuesta. Este m√©todo viene realmente del core de Node.js, espec√≠ficamente del m√©todo ``response.end()`` de ``http.ServerResponse``.	Finaliza el proceso de respuesta. Este m√©todo viene realmente del core de Node.js, espec√≠ficamente del m√©todo ``response.end()`` de ``http.ServerResponse``.


@@ -880,7 +966,11 @@ res.end();
res.status(404).end();	res.status(404).end();
```	```


**res.json()**	<div align="right">
  <small><a href="#tabla-de-contenido">ü°° volver al inicio</a></small>
</div>

### Response json()


Env√≠a una respuesta JSON. Este m√©todo env√≠a una respuesta (con el content-type correcto) y convierte el par√°metro enviado a una cadena de texto JSON haciendo uso de ``JSON.stringify()``.	Env√≠a una respuesta JSON. Este m√©todo env√≠a una respuesta (con el content-type correcto) y convierte el par√°metro enviado a una cadena de texto JSON haciendo uso de ``JSON.stringify()``.


@@ -892,7 +982,11 @@ res.json({ user: "tobi" });
res.status(500).json({ error: "message" });	res.status(500).json({ error: "message" });
```	```


**res.send()**	<div align="right">
  <small><a href="#tabla-de-contenido">ü°° volver al inicio</a></small>
</div>

### Response send()


Env√≠a una respuesta HTTP. El par√°metro ``body`` puede ser un objeto tipo _Buffer_, una cadena de texto, un objeto, o un arreglo. Por ejemplo:	Env√≠a una respuesta HTTP. El par√°metro ``body`` puede ser un objeto tipo _Buffer_, una cadena de texto, un objeto, o un arreglo. Por ejemplo:


@@ -918,13 +1012,13 @@ res.status(500).send({ error: "something blew up" });


Fechas importantes:	Fechas importantes:


- En el **2014** de express fueron adquiridos por una compa√±ia llamada [StrongLoop].	- En el **2014** de express fueron adquiridos por una compa√±ia llamada [StrongLoop](https://en.wikipedia.org/wiki/Strongloop).


- En septiembre **2015** [IBM] adquirio StrongLoop.	- En septiembre **2015** [IBM](https://es.wikipedia.org/wiki/IBM) adquirio StrongLoop.


- En enero del **2016** IBM anunci√≥ que express iba a ser dirigido por la [NodeJs Foundation](https://foundation.nodejs.org/)	- En enero del **2016** [IBM](#https://es.wikipedia.org/wiki/IBM) anunci√≥ que express iba a ser dirigido por la [NodeJs Foundation](https://foundation.nodejs.org/)


Caracterisiticas de express	<h4>Caracterisiticas de express</h4>


- **Minimalista**	- **Minimalista**
- **Template Engines**	- **Template Engines**
@@ -1136,7 +1230,7 @@ Luego seleccionamos el n√∫mero de filas (rows) que queremos generar y elegimos e
  <small><a href="#tabla-de-contenido">ü°° volver al inicio</a></small>	  <small><a href="#tabla-de-contenido">ü°° volver al inicio</a></small>
</div>	</div>


## Implementando un CRUD en expres.js	## Implementando un CRUD en express.js


**CRUD** viene de las siglas: _create read updated and delete_ esto significa **crear, leer, actualizar y eliminar**.	**CRUD** viene de las siglas: _create read updated and delete_ esto significa **crear, leer, actualizar y eliminar**.


@@ -1210,7 +1304,7 @@ El archivo de mocks estar√° disponible en este repositorio.
  <small><a href="#tabla-de-contenido">ü°° volver al inicio</a></small>	  <small><a href="#tabla-de-contenido">ü°° volver al inicio</a></small>
</div>	</div>


## M√©todos idempotentes del CRUD	### M√©todos idempotentes del CRUD


Acabamos de ver como podemos listar las peliculas, ahora lo que vamos a ver es el resto de m√©todos de ``CRUD``, para eso vamos a mirar el c√≥digo.	Acabamos de ver como podemos listar las peliculas, ahora lo que vamos a ver es el resto de m√©todos de ``CRUD``, para eso vamos a mirar el c√≥digo.


@@ -1855,12 +1949,12 @@ De est√° manera podemos implementar una capa del manejo de errores usando un mid
  <small><a href="#tabla-de-contenido">ü°° volver al inicio</a></small>	  <small><a href="#tabla-de-contenido">ü°° volver al inicio</a></small>
</div>	</div>


-- Me quede aqui.......------	
## Manejador de erroes as√≠ncronos y s√≠ncronos en Express	## Manejador de erroes as√≠ncronos y s√≠ncronos en Express


El manejo de errores en Express es el proceso de capturar un error de manera as√≠ncrona como s√≠ncrona . Por defecto Express viene con un manejador de errores por defecto, as√≠ que no es necesario escribir uno para empezar a usarlo.	El manejo de errores en Express es el proceso de capturar un error de manera as√≠ncrona como s√≠ncrona . **Por defecto Express viene con un manejador de errores por defecto**, as√≠ que no es necesario escribir uno para empezar a usarlo.


Los errores que ocurren de manera s√≠ncrona dentro un manejador de rutas o un middleware no requieren trabajo extra. Si un c√≥digo s√≠ncrono lanza un error Express autom√°ticamente capturar√° el error. Por ejemplo:	<span style="color:blue; font-weight: bold">Los errores que ocurren de manera s√≠ncrona dentro un manejador de rutas o un middleware no requieren trabajo extra. Si un c√≥digo _s√≠ncrono_ lanza un error Express autom√°ticamente capturar√° el error</span>. Por ejemplo:


```js	```js
app.get("/", function(req, res) {	app.get("/", function(req, res) {
@@ -1912,10 +2006,12 @@ app.get("/", function(req, res, next) {


## Capa de validaci√≥n de datos a trav√©z de un middleware	## Capa de validaci√≥n de datos a trav√©z de un middleware


La capa de validaci√≥n es necesaria porque cuando estamos consumiendo nuestros endpoints, los endpoints no saben que datos le estamos enviando, si estamos enviando en el caso de una pelicula con titulo o sin titulo, o a la hora de recibir las peliculas el formato del id es correcto, entonces mediante esta middleware podemos validar o podemos especificar unos schemas, de tal manera que podemos especificar que: la pelicula sea de tipo string, queremos que la numeraci√≥n sea de tipo n√∫mero, etc. De est√° manera si por alguna raz√≥n el cliente o el usuario ingrese los datos que no son, podemos especificar un error mostrando que partes son requeridas o que partes no tienen el formato, est√≥ le va ha ayudar al cliente o al usuario a que se de cuenta como debe consumir nuestras API.	La capa de validaci√≥n es necesaria porque cuando estamos **consumiendo** nuestros **endpoints**, los endpoints no saben que datos le estamos enviando, si estamos enviando en el caso de una pelicula con titulo o sin titulo, o a la hora de recibir las peliculas el formato del id es correcto, entonces mediante este **middleware podemos validar o podemos especificar unos schemas**, de tal manera que podemos especificar que: la pelicula sea de tipo string, queremos que la numeraci√≥n sea de tipo n√∫mero, etc. De est√° manera si por alguna raz√≥n el cliente o el usuario ingrese los datos que no son, podemos especificar un error mostrando que partes son requeridas o que partes no tienen el formato, est√≥ le va ha ayudar al cliente o al usuario a que se de cuenta como debe consumir nuestras API.

Para ello vamos a crear una funcionalidad que se va a llamar **validationHandler**, est√° funcionalidad va a **recibir** un **schema**, el esquema va a determinar c√∫al es el formato del esquema que vamos a enviar, **como segundo p√°rametro** le vamos a informar **donde queremos checar este esquema**, por defecto vamos a checar el **body del request**, pero tambi√©n podr√≠amos checar los p√°rametros o el query, etc. 
Cuando tenemos estos datos en la funci√≥n retornamos una funci√≥n que tiene la firma de un middleware, cogemos una utilidad que vamos a llamar validate, en est√© caso le vamos a pasar en el req **[check]** checando el body, y le vamos a pasar un schema y esto puede que devuelva o no un error de validaci√≥n, si devuelve un error, lo que vamos a hacer es llamar a nuestra funcionalidad next con el error. 


Para ello vamos a crear una funcionalidad que se va a llamar validationHandler, est√° funcionalidad va a recibir un schema, el esquema va a determinar c√∫al es el formato del esquema que vamos a enviar, como segundo p√°rametro le vamos a informar donde queremos checar este esquema, por defecto vamos a checar el body del request, pero tambi√©n podr√≠amos checar los p√°rametros o el query, etc. 	Acuerdence que cuando llamos a nuestra funcionalidad **next** con un p√°rametro, en est√© caso el error, van a empezar a ejecutarse los middlewares de error, si no simplemente llamos a nuestra funcionalidad next y **como no le estamos pasando ningun p√°rametro va a llamar al siguiente middleware**. 
Cuando tenemos estos datos en la funci√≥n retornamos una funci√≥n que tiene la firma de un middleware, cogemos una utilidad que vamos a llamar validate, en est√© caso le vamos a pasar en el req**[check]** checando el body, y le vamos a pasar un schema y esto puede que devuelva o no un error de validaci√≥n, si devuelve un error, lo que vamos a hacer es llamar a nuestra funcionalidad next con el error. Acuerdence que cuando llamos a nuestra funcionalidad next con un p√°rametro, en est√© caso el error, van a empezar a ejecutarse los middlewares de error, si no simplemente llamos a nuestra funcionalidad next y como no le estamos pasando ningun p√°rametro va a llamar al siguiente middleware 	


<div align="center">	<div align="center">
  <img src="./assets/validationHandler.png" alt="validationHandler">	  <img src="./assets/validationHandler.png" alt="validationHandler">
@@ -1927,10 +2023,10 @@ Cuando tenemos estos datos en la funci√≥n retornamos una funci√≥n que tiene la f


## ¬øQu√© es Join y Boom?	## ¬øQu√© es Join y Boom?


Join y Boom son tecnolog√≠as del ecositema de hapijs pero son tan buenas, que las vamos a integrar como middleware en nuestra aplicaci√≥n de express.	Join y Boom son tecnolog√≠as del ecositema de [hapijs](https://hapi.dev/) **pero son tan buenas, que las vamos a integrar como middleware en nuestra aplicaci√≥n de express**.


Join: Object schema validation, es la librer√≠a que nos va a ayudar a validar los schemas.	**Join**: Object schema validation, es la librer√≠a que nos va a ayudar a validar los schemas.
Boom: HTPP-friendly error objects. Es un manjeador de errores de una manera mucho m√°s comprensible.	**Boom**: HTPP-friendly error objects. Es un manjeador de errores de una manera mucho m√°s comprensible.


La mejor manera de entenderlos es visitando su documentaci√≥n oficial.	La mejor manera de entenderlos es visitando su documentaci√≥n oficial.


@@ -1939,14 +2035,14 @@ La mejor manera de entenderlos es visitando su documentaci√≥n oficial.


## Implementando Boom 	## Implementando Boom 


En esta secci√≥n aprenderemos a como podemos implementar Boom en nuestro c√≥digo de express. Lo que haremos ser√° usar boom en nuetros errorsHandlers que definimos con anterioridad, tambi√©n aprovecharemos para crear nuestro error 404 de tal manera que cuando hagan un request a un endpoint que no existe, respondamos correctamente, te mostrar√© como hacerlo en el codig√≥.	En esta secci√≥n aprenderemos a como podemos implementar Boom en nuestro c√≥digo de express. Lo que haremos ser√° usar boom en nuetros errorsHandlers que definimos con anterioridad, tambi√©n aprovecharemos para crear nuestro error ``404`` de tal manera que _cuando hagan un **request** a un **endpoint** que no existe, respondamos correctamente_, te mostrar√© como hacerlo en el codig√≥.


1. primero necesitamos instalar Boom ``npm i @hapi/boom``	1. primero necesitamos instalar Boom ``npm i @hapi/boom``
2. Nos diponemos a ir a nuestro middleware manejador de errores, en el vamos a incluir la dependecia de boom. 	2. Nos diponemos a ir a nuestro middleware manejador de errores, en el vamos a incluir la dependecia de boom. 
```js	```js
const boom = require('@hapi/boom');	const boom = require('@hapi/boom');
```	```
3. Como ya nos va a llegar un error boom, vamos a hacer un sprint-operator al error porque ahora el error no solo trae el mensaje, si no que trae unas propiedades como vimos, el **error, statusCode y message**, entonces es necesario hacer est√© peque√±o cambio 	3. Como ya nos va a llegar un error boom, vamos a hacer un [spread-operator](https://developer.mozilla.org/es/docs/Web/JavaScript/Referencia/Operadores/Spread_operator) al error porque ahora el error no solo trae el mensaje, si no que trae unas propiedades como vimos, el **error, statusCode y message**, entonces es necesario hacer est√© peque√±o cambio 
4. Crearemos un tercer middleware que se llamar√° **wrapErrors()** porque es posible que en alg√∫n punto el error que nos llegu√© no sea de tipo boom y nosotros queremos que apartir de ah√≠ todos los errores tengan la estructura boom.	4. Crearemos un tercer middleware que se llamar√° **wrapErrors()** porque es posible que en alg√∫n punto el error que nos llegu√© no sea de tipo boom y nosotros queremos que apartir de ah√≠ todos los errores tengan la estructura boom.
```js	```js
function wrapErrors(err, req, res, next) {	function wrapErrors(err, req, res, next) {
@@ -1990,7 +2086,7 @@ function validationHandler(schema, check = "body") {
}	}
```	```


Tambi√©n vamos a crear un middleware para menejar los erroes 404, el cual vamos a llamar notFoundHandler.	Tambi√©n vamos a crear un middleware para menejar los erroes ``404``, el cual vamos a llamar ``notFoundHandler.js``.


```js	```js
const boom = require('@hapi/boom');	const boom = require('@hapi/boom');
@@ -2001,7 +2097,7 @@ function notFoundHandler(req, res) { // eslint-disable-line
  res.status(statusCode).json(payload);	  res.status(statusCode).json(payload);
}	}
```	```
Est√° funci√≥n es un middleware pero no recibe el next, porque para que pueda funcionar, lo m√°s importante es que est√≥ debe ir al final de las rutas, el notFound lo que hace es que se ejecuta cuando ya paso por todas las rutas	Est√° funci√≥n es un **middleware** pero <span style="font-weight: bold; color:blue;">no recibe el next, porque para que pueda funcionar, lo m√°s importante es que est√≥ debe ir al final de las rutas</span>, el ``notFound`` lo que hace es que se ejecuta cuando ya paso por todas las rutas


Ahora solo lo requerimos en nuestro archivo index y lo agregamos al final de las rutas.	Ahora solo lo requerimos en nuestro archivo index y lo agregamos al final de las rutas.


@@ -2023,7 +2119,7 @@ Ahora si intentamos hacer una llamada con una ruta inexistente nos marcar√° el e


En est√© modulo vamos a implementar joi con nuestra capa de validaci√≥n de datos.	En est√© modulo vamos a implementar joi con nuestra capa de validaci√≥n de datos.


1. Necesitamos instalar joi como una dependencia ``npm i @hapi/joi``	1. Necesitamos instalar **joi** como una dependencia ``npm i @hapi/joi``
2. Vamos a ir a nuestro middleware de validationHandler.	2. Vamos a ir a nuestro middleware de validationHandler.
3. Vamos a requerir joi. Recuerdan que teniamos la funcionalidad validate retornando false, ahora la vamos a implementar.	3. Vamos a requerir joi. Recuerdan que teniamos la funcionalidad validate retornando false, ahora la vamos a implementar.
```js	```js
@@ -2104,7 +2200,7 @@ Ahora lo que debemos hacer es aplicar estos esquemas en nuestras rutas, para ell


Inicialmente para el GET no le vamos a aplicar ninguna regla de validation, pero para el GET cuando recibe un id, es decir el especifico si lo vamos a hacer, primero traer nuestro validationHandler el cual tambi√©n debemos de requerir.	Inicialmente para el GET no le vamos a aplicar ninguna regla de validation, pero para el GET cuando recibe un id, es decir el especifico si lo vamos a hacer, primero traer nuestro validationHandler el cual tambi√©n debemos de requerir.


Recuerden que nuestro validationHandler va a recibir un schema y tambi√©n va a recibir de donde va a sacar los datos, por defecto va a sacarlo del body, pero en el caso del getMovieId lo vamos a sacar de los parametros porque el id viene de los parametros.	Recuerden que nuestro **validationHandler** va a **recibir** un **schema** y tambi√©n **va a recibir de donde va a sacar los datos**, por defecto va a sacarlo del body, pero en el caso del getMovieId lo vamos a sacar de los parametros porque el id viene de los parametros.


```js	```js
 router.get("/:movieId", validationHandler(joi.object({ movieId: movieIdSchema }), 'params'), async function (req, res, next) { 	 router.get("/:movieId", validationHandler(joi.object({ movieId: movieIdSchema }), 'params'), async function (req, res, next) { 
@@ -2230,9 +2326,12 @@ El modulo ``inspect`` de Node.js nos permite ejecutar un ambiente para hacer deb
  <small><a href="#tabla-de-contenido">ü°° volver al inicio</a></small>	  <small><a href="#tabla-de-contenido">ü°° volver al inicio</a></small>
</div>	</div>
### Creaci√≥n de test para nuestros endpoints	## Tests
---
En est√© modulo aprenderemos a crear test con nodejs, la primer suit de test que vamos a crear es para nuestros endpoints que est√°n √∫bicados a la capa de rutas, su √∫nica responsabilidad de test es probar que le llegan los datos y devuelven los datos correspondientes, vamos a ver como se hace en el c√≥digo.	## Creaci√≥n de test para nuestros endpoints
<span style="text-decoration; font-weight:bold; color: brown; text-align: justify;">En est√© modulo aprenderemos a crear test con nodejs, la primer suit de test que vamos a crear es para nuestros endpoints que est√°n √∫bicados a la capa de rutas,</span> **su √∫nica responsabilidad de test es probar que le llegan los datos y devuelven los datos correspondientes**, vamos a ver como se hace en el c√≥digo.
1. Lo primero es instalar nuestras dependencias para los test 	1. Lo primero es instalar nuestras dependencias para los test 
``npm i -D mocha supertest sinon proxyquire``	``npm i -D mocha supertest sinon proxyquire``
@@ -2282,7 +2381,7 @@ module.exports = {
};	};
```	```
3. El pr√≥ximo pasa va a ser en nuestra carpeta de utilidades crear un test server, est√© test es un server que su √∫nica misi√≥n va a ser levantar un server para pruebas. Los Test siempre se deben correr independientes del server original y m√°s porque en est√© caso no queremos levantar todo lo que tienen nuestro server, solo queremos un server muy peque√±o que nos ayude a probar.	3. El pr√≥ximo va a ser en nuestra carpeta de utilidades, es crear un test server, est√© es un server que su √∫nica misi√≥n va a ser levantar un server para pruebas. **Los Test siempre se deben correr independientes del server original** y m√°s porque en est√© caso no queremos levantar todo lo que tienen nuestro server, solo queremos un server muy peque√±o que nos ayude a probar.
```js	```js
const express = require('express');	const express = require('express');
@@ -2301,7 +2400,7 @@ function testServer(route) {
module.exports = testServer;	module.exports = testServer;
```	```
Con est√≥ ya tenemos lo necesario para empezar a crear nuestros test, entonces vamos a crear una carpeta que se llam√© test y en est√© caso como queremos hacer test a las rutas se va a llamar routes.movies.test.js, es buena pr√°ctica que est√© archivo finalice en **.test.js** 	Con est√≥ ya tenemos lo necesario para empezar a crear nuestros test, entonces vamos a crear una carpeta que se llam√© test y en est√© caso como queremos hacer test a las rutas se va a llamar ``routes.movies.test.js``, es buena pr√°ctica que est√© archivo finalice en **.test.js** 
```js	```js
// obtenemos el assert que es el que se encarg√° de verificar si es verdad o no nuestra	// obtenemos el assert que es el que se encarg√° de verificar si es verdad o no nuestra
@@ -2383,7 +2482,7 @@ Vamos a escribir otro test, est√© test que vamos a escribir, es el test que nos
Si volvemos a correr nuestros test y funcionar√° bien si los mensajes de los test son iguales a de las rutas.	Si volvemos a correr nuestros test y funcionar√° bien si los mensajes de los test son iguales a de las rutas.
Los Test son muy importante hacerlos en el c√≥digo, porque si en un futuro hacen cambios, el test nunca se rompa, por ejemplo si en un futuro por alguna raz√≥n, llegar√°n y sin ninguna intenci√≥n, cambiar√°n el mensaje que ser√≠a un error, si corremos nuestros test nos van a fallar y nos va a decir que no es exactamente igual.	Los Test son muy importante hacerlos en el c√≥digo, porque si en un futuro hacen cambios, el test nunca se rompan, por ejemplo si en un futuro por alguna raz√≥n, llegar√°n y sin ninguna intenci√≥n, cambiar√°n el mensaje que ser√≠a un error, si corremos nuestros test nos van a fallar y nos va a decir que no es exactamente igual.
 	 
**Los test son una buena manera de poder asegurar que nuestro c√≥digo tiene calidad y que si en el futuro hay cambios, no se va a poder romper nuestro c√≥digo**. 	**Los test son una buena manera de poder asegurar que nuestro c√≥digo tiene calidad y que si en el futuro hay cambios, no se va a poder romper nuestro c√≥digo**. 
@@ -2397,12 +2496,11 @@ En est√° secci√≥n aprenderas a crear los test para nuestra capa de servicios, al
_Lo que vamos a hacer es que vamos a ir a nuestra carpeta de utilis - mocks y vamos a crear un nuevo mock que ser√≠a para librer√≠a de mongo_	_Lo que vamos a hacer es que vamos a ir a nuestra carpeta de utilis - mocks y vamos a crear un nuevo mock que ser√≠a para librer√≠a de mongo_
vamos a requerir **sinon**, **sinon** lo que **nos permite crear struct o mocks** **sinon** cada vez que creamos un nuevo struct, les inyecta unas propiedades si estos fueron llamados o no. Entonces es super √∫til para que podamos en nuestros servicos probar cuando el servicio fue ejecuta si llam√≥ los m√©todos de las respectivas librer√≠as.	Vamos a requerir **sinon**. Lo que **nos permite crear struct o mocks**, **sinon** cada vez que creamos un nuevo ``struct``, les ``inyecta unas propiedades`` si estos fueron llamados o no. Entonces es super √∫til para que en nuestros servicos puedamos probar cuando el servicio fue ejecutado, si llam√≥ los m√©todos de las respectivas librer√≠as.
Tambi√©n vamos a traer de los **mocks**, los mocks que creamos con anterioridad de las peliculas y de la funcionalidad ``filteredMoviesMock``, esto es con el fin de cuando se haga un test con los tags podamos simular que se filtro, lo llamos que estamos en la misma carpeta de mocks. 	Tambi√©n vamos a traer de los **mocks**. Los mocks que creamos con anterioridad de las peliculas y de la funcionalidad ``filteredMoviesMock``, esto es con el fin de cuando se haga un test con los tags podamos simular que se filtro. Luego vamos a hacer la creaci√≥n de nuestros ``structs``. 
Luego vamos a hacer la creaci√≥n de nuestros structs. 	
El primero ser√≠a getAll de mongo, uno de los m√©todos que tienen los structs es por ejemplo decidir que cuando se llam√© con ciertos argumentos resuelva con cierta respuesta, en est√© caso vamos a decir que cuando lo llam√© con movies que ser√≠a la collection que le va a pasar el servicio a la librer√≠a de mongo, pues resuelva con nuestros mocks de las peliculas.	El primero ser√≠a ``getAll`` de mongo, uno de los m√©todos que tienen los ``structs`` es por ejemplo decidir que cuando se llam√© con ciertos argumentos resuelva con cierta respuesta, en est√© caso vamos a decir que cuando lo llam√© con movies que ser√≠a la collection que le va a pasar el servicio a la librer√≠a de mongo, pues resuelva con nuestros mocks de las peliculas.
Ahora lo que debemos hacer es crear un nuevo archivo para los test de nuestros servicios, el cual vamos a llamar	Ahora lo que debemos hacer es crear un nuevo archivo para los test de nuestros servicios, el cual vamos a llamar
@@ -2412,9 +2510,9 @@ Ahora lo que debemos hacer es crear un nuevo archivo para los test de nuestros s
## Creaci√≥n de Test para nuestras utilidades 	## Creaci√≥n de Test para nuestras utilidades 
Vamos a crear test para nuestras utilidades pero esta vez vamos a hacerlo haciendo uso de td, la t√©cnica de td trata primero crear los test y luego la funcionalidad, personalmente considero que hay unos caso que vale la pena usar td, por ejemplo cuando se tiene muy claro cu√°l es la l√≥gica de negocio, si tu tienes muy clara la l√≥gica de negocio, muy f√°cil puedes crear los test y luego solucionarlo en la funcionalidad, si no es claro la verdad no va a funcionar td para nada, otro caso donde es muy com√∫n hacer td es cuando tienes un bug, escribes un test que va a fallar porque existe el bug, corriges el bug y luego el test deber√≠a pasar, as√≠ aseguras que ese bug no va a volver a suceder porque ya tienes un test que lo impide, vamos a ver como se hace en el c√≥digo. Lo que vamos a solucionar en est√© caso es una utilidad que vamos a crear para que imprima los mesajes de nuestras rutas, recuerden que nosotros en nuestra ruta simpre devolvemos un mensaje.	Vamos a crear test para nuestras utilidades pero esta vez vamos a hacerlo haciendo uso de td, la t√©cnica de **td** <span style="color:red; font-weight:bold;">trata primero crear los test y luego la funcionalidad</span>, personalmente considero que hay algunos casos que vale la pena usar **td**, por ejemplo cuando se tiene muy claro cu√°l es la l√≥gica de negocio, si tu tienes muy clara la l√≥gica de negocio, muy f√°cil puedes crear los test y luego solucionarlo en la funcionalidad, si no es claro la verdad no va a funcionar td para nada, otro caso donde **es muy com√∫n hacer td es cuando tienes un bug**, escribes un test que va a fallar porque existe el bug, corriges el bug y luego el test deber√≠a pasar, as√≠ aseguras que ese bug no va a volver a suceder porque ya tienes un test que lo impide, vamos a ver como se hace en el c√≥digo. Lo que vamos a solucionar en est√© caso es una utilidad que vamos a crear para que imprima los mesajes de nuestras rutas, recuerden que nosotros en nuestra ruta simpre devolvemos un mensaje.
Nosotros quisieramos automatizar est√≥, entonces vamos a crear una utilidad que haga eso, la cual vamos a llamar **buildMessage** y como estamos haciendo td, lo √∫nico que vamos a definir es el cuerpo de la utilidad, que en est√© caso va a recibir una entidad, porque as√≠ lo defini en mi l√≥gica de negocio, la c√∫al vamos a exportar. Por ahora est√° utilidad no hace nada, porque primero vamos a escribir los test y a media que vamos resolviendo los test es lo que nos va a determinar como solucionamos esa utilidad.	Nosotros quisieramos automatizar est√≥, entonces vamos a crear una utilidad que haga eso, la cual vamos a llamar **buildMessage** y como estamos haciendo **td**, lo √∫nico que vamos a definir es el cuerpo de la utilidad, que en est√© caso va a recibir una entidad, porque as√≠ lo defin√≠ en mi l√≥gica de negocio, la c√∫al vamos a exportar. Por ahora est√° utilidad no hace nada, primero vamos a escribir los test y a media que vamos resolviendo los test es lo que nos va a determinar como solucionamos esa utilidad.
1. En la carpeta test vamos crear un nuevo archivo llamado *utils.buildMessage.test.js*.	1. En la carpeta test vamos crear un nuevo archivo llamado *utils.buildMessage.test.js*.
@@ -2457,19 +2555,19 @@ describe.only('utils - buildMessage', function () {
});	});
```	```
Con est√© ejemplo introductorio de TD, nos hemos dado cuenta como nos puede ayudar a hacer refactori de una forma mucho m√°s segura, o incluso evitar que halla bugs en un futuro cuando por alguna raz√≥n sucede.	Con est√© ejemplo introductorio de TD, nos hemos dado cuenta como nos puede ayudar a hacer ``refactori`` de una forma mucho m√°s segura, o incluso evitar que halla bugs en un futuro cuando por alguna raz√≥n sucede.
<div align="right">	<div align="right">
  <small><a href="#tabla-de-contenido">ü°° volver al inicio</a></small>	  <small><a href="#tabla-de-contenido">ü°° volver al inicio</a></small>
</div>	</div>
## Agregando un comando coverage	## Agregando un comando coverage
Los Test son muy importantes, pero tambi√©n es muy importante asegurarnos que estamos probando todos los caminos de una funcionalidad a la hora de hacer test, un comando de coverage nos permite identificar en donde estamos fallando y como los podemos corregir.	Los Test son muy importantes, pero tambi√©n es muy importante asegurarnos que estamos probando todos los caminos de una funcionalidad a la hora de hacer test, un comando de **coverage** nos permite identificar en donde estamos fallando y como los podemos corregir.
Para correr nuestro reporte de covegare, lo primero que tenemos que hacer es instalar una nueva herrmienta que se llam√° **nyc**. ``npm i -D nyc``	Para correr nuestro reporte de covegare, lo primero que tenemos que hacer es instalar una nueva herrmienta que se llam√° **nyc**. ``npm i -D nyc``
**nyc**: hace parte de una herramienta llamada **istabul**.	**nyc**: hace parte de una herramienta llamada [istabul](https://istanbul.js.org/).
Luego lo que necesitamos crear es nuestro comando el packages.json	Luego lo que necesitamos crear es nuestro comando el ``packages.json``
```json	```json
{	{
    "scripts": {	    "scripts": {
@@ -2483,9 +2581,9 @@ Luego lo que necesitamos crear es nuestro comando el packages.json
}	}
```	```
Est√°s herramientas nos ayudan a generar diferentes reportes, sean para enviroments de integraci√≥n continua o sea para nuestros ojos, en est√© caso vamos a crear un reporte que va ha est√°r en html.	Est√°s herramientas nos ayudan a generar diferentes reportes, sean para **environments** de integraci√≥n continua o sea para nuestros ojos, en est√© caso vamos a crear un reporte que va ha est√°r en html.
Lo otro que debemos hacer es configurar como queremos hacer nuestro coverage, para ello nos vamos al final de nuestro package.json, y decimos que _para ncy lo que queremos que testee es:	Lo otro que debemos hacer es configurar como queremos hacer nuestro coverage, para ello nos vamos al final de nuestro ``package.json``, y decimos que para ncy lo que queremos que testee es:
```json	```json
{	{
  "nyc": {	  "nyc": {
@@ -2495,7 +2593,7 @@ Lo otro que debemos hacer es configurar como queremos hacer nuestro coverage, pa
}	}
``` 	``` 
Est√≥ es muy importante porque nos ayuda a vizualizar el nivel de covertura de nuestra aplicaci√≥n, en el equipo se puede definir un minimo aceptable, la recomendaci√≥n de minimo aceptable es entre 60 y el 80% porque tiene poco sentido obsecionarse por obtener el 100%, porque es mucho m√°s importante crear producto que simplemente estar creando test.	Est√≥ es muy importante porque nos ayuda a vizualizar el nivel de covertura de nuestra aplicaci√≥n, en el equipo se puede definir un **minimo aceptable**, **la recomendaci√≥n** de minimo aceptable **es entre 60 y el 80%** porque tiene poco sentido obsecionarse por obtener el 100%, porque **es mucho m√°s importante crear producto que simplemente estar creando test**.
En est√© modulo podimoss vizualizar: 	En est√© modulo podimoss vizualizar: 
@@ -2505,17 +2603,17 @@ En est√© modulo podimoss vizualizar:
Challenge: Termina el resto de los test de las rutas, servicios y utilidades.	Challenge: Termina el resto de los test de las rutas, servicios y utilidades.
Hacer test puede ser mucho m√°s complicado que incluso est√°r escribiendo c√≥digo pero te recomiendo que tengas mucha pasiencia.	**Hacer test puede ser mucho m√°s complicado que incluso est√°r escribiendo c√≥digo pero te recomiendo que tengas mucha pasiencia**.
<div align="right">	<div align="right">
  <small><a href="#tabla-de-contenido">ü°° volver al inicio</a></small>	  <small><a href="#tabla-de-contenido">ü°° volver al inicio</a></small>
</div>	</div>
## Considerenado las mejores pr√°cticas para el despliegue 	## Considerenado las mejores pr√°cticas para el despliegue 
En est√© punto ya tu apliaci√≥n est√° lista para el despliegue, pero lo que debemos considerar unas muy buenas pr√°cticas para el lanzamiento a producci√≥n.	En est√© punto ya tu aplicaci√≥n est√° lista para el despliegue, pero lo que debemos considerar unas muy buenas pr√°cticas para el lanzamiento a producci√≥n.
Buenas pr√°cticas:	**Buenas pr√°cticas**:
- Remover constrase√±as quemadas	- Remover constrase√±as quemadas
- Encapsular c√≥digo spaghetti	- Encapsular c√≥digo spaghetti
- Revisar la estructura del proyecto	- Revisar la estructura del proyecto
@@ -2524,27 +2622,27 @@ Buenas pr√°cticas:
- A√±adir HTTPS y CORS	- A√±adir HTTPS y CORS
- Revisar otras pr√°cticas de seguridad.	- Revisar otras pr√°cticas de seguridad.
El termino quemado significa: tener las contrase√±as directamente en el c√≥digo y no en variables o variables de entorno, lo que sucede es que si estas contrase√±as se suben al repositorio, podr√≠a malisiosamente leerse el archivo .git y sacar eso del historial, incluso si ya lo haz hecho y removido en otro commit, es muy importante que lo elimines del historial.	El termino **quemado significa**: tener las contrase√±as directamente en el c√≥digo y no en variables o variables de entorno, lo que sucede es que si estas contrase√±as se suben al repositorio, podr√≠a malisiosamente leerse el archivo .git y sacar eso del historial, incluso si ya lo haz hecho y removido en otro commit, es muy importante que lo elimines del historial.
Aqu√≠ hay un lectura para remover los datos confidenciales del historial si te ha pasado: https://help.github.com/es/articles/removing-sensitive-data-from-a-repository	Aqu√≠ hay un lectura para remover los datos confidenciales del historial si te ha pasado: https://help.github.com/es/articles/removing-sensitive-data-from-a-repository
El c√≥digo spaghetti es ese c√≥digo que es muy dificil de leer o creece mucho, lo m√°s recomendable es mover porciones de c√≥digo a diferentes funciones que tengan mucho significado en esa porcion de c√≥digo en especifico.	El **c√≥digo spaghetti** es ese c√≥digo que es muy dificil de leer o creece mucho, lo m√°s recomendable es mover porciones de c√≥digo a diferentes funciones que tengan mucho significado en esa porcion de c√≥digo en especifico.
Scripts de build: si tu proyecto tienen alg√∫n paso de build, como de pronto minificar o transpilar c√≥digo tambi√©n es necesario que est√© para que se vayan en c√≥digo optimo para producci√≥n.	Scripts de **build**: si tu proyecto tienen alg√∫n paso de build, como de pronto minificar o transpilar c√≥digo tambi√©n es necesario que est√© para que se vayan en c√≥digo optimo para producci√≥n.
Soporte de cache: muchas veces cuando requerimos las peliculas, ellas no cambian porque no todo el tiempo se est√°n agregando peliculas nuevas, entonces es importante tener una capa de cache tipo: _en 15 minutos siempre enviame el mismo resultado_, de est√° manera no tenemos que ir hasta base de datos a traer las peliculas, sino que las traemos del cache del navegador.	Soporte de cache: muchas veces cuando requerimos las peliculas, ellas no cambian porque no todo el tiempo se est√°n agregando peliculas nuevas, entonces es importante tener una capa de cache tipo: _en 15 minutos siempre enviame el mismo resultado_, de est√° manera no tenemos que ir hasta base de datos a traer las peliculas, sino que las traemos del cache del navegador.
Https: la conexi√≥nes por https son encriptadas y seguras, si por alguna vez un usuario y contrase√±a por una conexi√≥n que no es https, f√°cilmente podr√≠a agarrar tu usuario y contrase√±a porque est√°n en texto plano.	**Https**: la conexi√≥nes por https son encriptadas y seguras, si por alguna vez un usuario y contrase√±a por una conexi√≥n que no es https, f√°cilmente podr√≠a agarrar tu usuario y contrase√±a porque est√°n en texto plano.
Cors: sirve para que no todos los clientes se conecten a nuestro backend y no nos hagan cosas maliciosas, lo otro que es importante es que est√© revisando las buenas pr√°cticas de seguridad, que explores librer√≠as como helmer o que revises open web application security project (owasp).	**Cors**: sirve para que no todos los clientes se conecten a nuestro backend y no nos hagan cosas maliciosas, lo otro que es importante es que est√© revisando las buenas pr√°cticas de seguridad, que explores librer√≠as como ``helmer`` o que revises open web ``application security project`` (owasp).
<div align="right">	<div align="right">
  <small><a href="#tabla-de-contenido">ü°° volver al inicio</a></small>	  <small><a href="#tabla-de-contenido">ü°° volver al inicio</a></small>
</div>	</div>
## Variables de entorno, CORS y HTTPS	## Variables de entorno, CORS y HTTPS
### Como usar las variables de entorno para diferente ambientes	### Como usar las variables de entorno para diferentes ambientes
Ya vimos c√≥mo en nuestro ambiente local podemos hacer uso de las variables de entorno usando el archivo ``.env`` y la librer√≠a ``dotenv.`` Generalmente lo que se recomienda es usar el mismo para los diferentes ambientes como **Staging (Pruebas)** y **Producci√≥n**.	Ya vimos c√≥mo en nuestro ambiente local podemos hacer uso de las variables de entorno usando el archivo ``.env`` y la librer√≠a ``dotenv.`` Generalmente lo que se recomienda es usar el mismo para los diferentes ambientes como **Staging (Pruebas)** y **Producci√≥n**.
@@ -2561,7 +2659,7 @@ Como lo hemos dicho antes no se debe hacer commit del archivo ``.env`` y este de
  <small><a href="#tabla-de-contenido">ü°° volver al inicio</a></small>	  <small><a href="#tabla-de-contenido">ü°° volver al inicio</a></small>
</div>	</div>
### Cuando no es posible acceder al servidor remoto	### ¬øCuando no es posible acceder al servidor remoto?
Algunos servicios como [Heroku](https://www.heroku.com/) o [Now](https://zeit.co/home) no nos permiten acceder a un servidor remoto pues la administraci√≥n del servidor es controlada por los mismos servicios, sin embargo cada servicio tiene sus mecanismos para establecer las variables de entorno:	Algunos servicios como [Heroku](https://www.heroku.com/) o [Now](https://zeit.co/home) no nos permiten acceder a un servidor remoto pues la administraci√≥n del servidor es controlada por los mismos servicios, sin embargo cada servicio tiene sus mecanismos para establecer las variables de entorno:
@@ -2636,7 +2734,7 @@ app.listen(8000, function() {
});	});
```	```
Debemos tener en cuenta que para aplicaciones server-side es poco probable que necesiten el uso de CORS debido a que las aplicaciones conviven en el mismo dominio. Sin embargo, es buena practica habilitarlo para los llamados externos de nuestra API.	Debemos tener en cuenta que para aplicaciones ``server-side`` es poco probable que necesiten el uso de CORS debido a que las aplicaciones conviven en el mismo dominio. Sin embargo, es buena practica habilitarlo para los llamados externos de nuestra API.
M√°s informaci√≥n sobre el middleware CORS en	M√°s informaci√≥n sobre el middleware CORS en
https://expressjs.com/en/resources/middleware/cors.html	https://expressjs.com/en/resources/middleware/cors.html
@@ -2647,7 +2745,7 @@ https://expressjs.com/en/resources/middleware/cors.html
### C√≥mo funciona y por qu√© es importante el uso de HTTPS	### C√≥mo funciona y por qu√© es importante el uso de HTTPS
El Protocolo Seguro de Transferencia de Hipertexto (HTTPS) es un protocolo HTTP que funciona en el puerto 443 y utiliza un cifrado basado en SSL (Secure Sockets Layer) / TLS (Transmission Layer security) con el fin de crear un canal de comunicaci√≥n seguro entre el cliente y el servidor.	El __Protocolo Seguro de Transferencia__ de Hipertexto (HTTPS) es un protocolo HTTP que **funciona** en el puerto **443** y utiliza un **cifrado** basado en **SSL** (Secure Sockets Layer) / **TLS** (Transmission Layer security) con el fin de crear un canal de comunicaci√≥n seguro entre el cliente y el servidor.
<div align="right">	<div align="right">
  <small><a href="#tabla-de-contenido">ü°° volver al inicio</a></small>	  <small><a href="#tabla-de-contenido">ü°° volver al inicio</a></small>
@@ -2657,13 +2755,9 @@ El Protocolo Seguro de Transferencia de Hipertexto (HTTPS) es un protocolo HTTP
Una de las razones por la cual siempre debemos usar sitios con HTTPS es que sin este cualquier individuo podr√≠a efectuar ataques conocidos como [man-in-the-middle](https://en.wikipedia.org/wiki/Man-in-the-middle_attack) o [eavesdropping](https://en.wikipedia.org/wiki/Eavesdropping) y obtener nuestro usuario y contrase√±a en el momento en que intentamos acceder a este servicio que no tiene HTTPS establecido.	Una de las razones por la cual siempre debemos usar sitios con HTTPS es que sin este cualquier individuo podr√≠a efectuar ataques conocidos como [man-in-the-middle](https://en.wikipedia.org/wiki/Man-in-the-middle_attack) o [eavesdropping](https://en.wikipedia.org/wiki/Eavesdropping) y obtener nuestro usuario y contrase√±a en el momento en que intentamos acceder a este servicio que no tiene HTTPS establecido.
<div align="right">	
  <small><a href="#tabla-de-contenido">ü°° volver al inicio</a></small>	
</div>	
### C√≥mo funciona	### C√≥mo funciona
1. El cliente env√≠a un mensaje al servidor y este responde con su certificado publico.	1. El cliente env√≠a un mensaje al servidor y este responde con su certificado p√∫blico.
2. El cliente comprueba que este certificado sea valido y toma la llave publica.	2. El cliente comprueba que este certificado sea valido y toma la llave publica.
3. El cliente genera una cadena llamada pre-master secret y la cifra usando la llave publica del servidor y se lo env√≠a.	3. El cliente genera una cadena llamada pre-master secret y la cifra usando la llave publica del servidor y se lo env√≠a.
4. El servidor usa su llave privada para comprobar el pre-master secret.	4. El servidor usa su llave privada para comprobar el pre-master secret.
@@ -2692,7 +2786,7 @@ M√°s informaci√≥n:
## Como implementar una capa de manejo de cach√© en express	## Como implementar una capa de manejo de cach√© en express
Lo primero que vamos a hacer es crear un archivo en utilidades llamado time.js, donde vamos a establecer unos tiempos.	Lo primero que vamos a hacer es crear un archivo en utilidades llamado ``time.js``, donde vamos a establecer unos tiempos.
```js	```js
// el cache se mide en segundos	// el cache se mide en segundos
@@ -2709,7 +2803,7 @@ Teniendo esos tiempos ahora puedo manejar mi utilidad menejo de cache, en la mis
Lo mas sano para el desarrollador es verificar si no tenemos el cache activado.	Lo mas sano para el desarrollador es verificar si no tenemos el cache activado.
Para ello nuestra funcionalidad solo se va a ejecutar response, si no estamos en modo desarrollo. Le vamos a pasar el response porque es el que modificamos para agregar el cache, y los segundos que queremos aplicar.	Para ello nuestra funcionalidad solo se va a ejecutar response, si no estamos en modo desarrollo. Le vamos a pasar el ``response`` porque es el que modificamos para agregar el cache, y los segundos que queremos aplicar.
```js	```js
const { config } = require('../config/index');	const { config } = require('../config/index');
@@ -2803,7 +2897,7 @@ con yarn ``yarn global add now``
Ahora lo primero que tenemos que hacer es considerar nuestras variables de entorno, pues si instalamos nuestra aplicaci√≥n si pasarselas al despliegue no van a tener ning√∫n valor, lo que vamos a hacer es que las vamos a sacar de el archivo ``.env``.	Ahora lo primero que tenemos que hacer es considerar nuestras variables de entorno, pues si instalamos nuestra aplicaci√≥n si pasarselas al despliegue no van a tener ning√∫n valor, lo que vamos a hacer es que las vamos a sacar de el archivo ``.env``.
La manera en como now nos permite administrar nuestras variables de entorno, es mediante alg√≥ llamado secrets, un secret lo que hace es guardar nuestra variable de entorno y nunca m√°s nos deja acceder a ese resultado, as√≠ podemos cuidarnos de que nadie venga nuestra m√°quina y nos saque el valor de la variable de entorno, la manera en como se hace es con ``now secret add nombreVariableEntorno``, y as√≠ sucesivamente con todas nuestras variables de entorno.	La manera en como now nos permite administrar nuestras variables de entorno, es mediante alg√≥ llamado secrets, ``un secret lo que hace es guardar nuestra variable de entorno y nunca m√°s nos deja acceder a ese resultado``, as√≠ podemos cuidarnos de que nadie venga nuestra m√°quina y nos saque el valor de la variable de entorno, la manera en como se hace es con ``now secret add nombreVariableEntorno``, y as√≠ sucesivamente con todas nuestras variables de entorno.
El archivo ``now.json`` que usaremos para el despliegue quedar√≠a de la siguiente manera:	El archivo ``now.json`` que usaremos para el despliegue quedar√≠a de la siguiente manera:
```json	```json
@@ -2827,7 +2921,7 @@ Si al desplegar nuestra aplicaci√≥n con now dev nos muestra un error cuando se c
(node:414) DeprecationWarning: current Server Discovery and Monitoring engine is deprecated, and will be removed in a future version. To use the new Server Discover and Monitoring engine, pass option { useUnifiedTopology: true } to the MongoClient constructor.	(node:414) DeprecationWarning: current Server Discovery and Monitoring engine is deprecated, and will be removed in a future version. To use the new Server Discover and Monitoring engine, pass option { useUnifiedTopology: true } to the MongoClient constructor.
Connected succesfully to mongo	Connected succesfully to mongo
``	``
Tenemos que agregar el nuevo motor de descubrimiento del monitoreo del servidor.	Tenemos que agregar el nuevo motor de descubrimiento al monitoreo del servidor.
``{ useUnifiedTopology: true }``, lo hacemos de la siguiente manera:	``{ useUnifiedTopology: true }``, lo hacemos de la siguiente manera:
```js	```js
@@ -2840,4 +2934,8 @@ constructor() {
  <small><a href="#tabla-de-contenido">ü°° volver al inicio</a></small>	  <small><a href="#tabla-de-contenido">ü°° volver al inicio</a></small>
</div>	</div>
<br>	<br>
Una vez hecho esto, podemos probar nuestra servidor usando now dev, para que lo ejecute de manera local, y escribimos solo now para enviar el servicio a producci√≥n, y cada vez que hall√° cambios, solo volvemos a hacer now al proyecto.
<br>
<br>
<p align="center" style="font-style: italic;">by: Jasan Hern√°ndez :D</p>
<br>
